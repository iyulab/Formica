# 개념적 사상 원리

## 핵심 원칙

> **"양식의 구조는 구현 구조로 자연스럽게 변환됩니다"**

이 문서는 Formology 양식을 구현으로 **사상(Mapping)**하는 기술 중립적 원리를 제시합니다.

---

## 1. 기본 사상 규칙

### 계층 사상

```
서식 (Format)    → 스키마/인터페이스
양식 (Form)      → 구조/클래스
문서 (Document)  → 인스턴스/레코드
```

**예시**:
```
[양식] 품질검사의뢰서: 제품명, LOT번호, 수량
  ↓
[구현] QCRequest: product_id, lot_number, quantity
```

---

## 2. 구조적 사상

### 양식 → 엔티티

**규칙**: 하나의 양식 = 하나의 주요 엔티티

```
[양식]                [엔티티]
품질검사의뢰서         QCRequest
├─ 의뢰번호           ├─ request_number
├─ 제품명 [선택]      ├─ product_id (FK)
├─ LOT번호            ├─ lot_number
└─ 수량               └─ quantity
```

**예외**:
- 복합 문서: 여러 엔티티로 분해
- 섹션이 많은 문서: 정규화 고려

### 섹션 → 엔티티 분해

**판별 기준**:
1. **반복성**: 섹션이 여러 번 나타나는가?
2. **독립성**: 독자적 생명주기를 가지는가?
3. **재사용성**: 다른 양식에서도 사용되는가?

**예시**:
```
[주문서]
헤더
  ├─ 주문번호
  └─ 고객명
품목 (반복) ← 별도 엔티티
  ├─ 제품명
  └─ 수량

[사상]
Order (1)
  └─ OrderItem (N)
```

### 필드 → 속성

| 필드 유형 | 데이터 타입 | 제약조건 |
|-----------|-------------|----------|
| [입력] | VARCHAR, TEXT | - |
| [숫자] | INTEGER, DECIMAL | - |
| [날짜] | DATE, TIMESTAMP | - |
| [선택] | FK 또는 ENUM | NOT NULL |
| [체크박스] | BOOLEAN | - |
| 본질적 | (위 타입) | NOT NULL |
| 부가적 | (위 타입) | NULLABLE |

---

## 3. 관계 사상

### 참조 (Reference)

```
양식: 문서 A --참조--> 문서 B
  ↓
구현: Entity_A.b_id → Entity_B.id (FK, 실시간)
```

**특성**:
- 외래키로 구현
- 참조 무결성 제약
- JOIN으로 최신 정보 조회

### 붙임 (Attachment)

```
양식: 문서 A --붙임--> 문서 B의 사본
  ↓
구현: Entity_A.attached_b_snapshot (JSON/별도 테이블)
```

**특성**:
- 값 복사 또는 스냅샷
- 독립적 생명주기
- 원본 변경 무관

### 스냅샷 (Snapshot)

```
양식: 문서 A --스냅샷--> 문서 B@시점T
  ↓
구현: Entity_A_Snapshot (버전 테이블)
```

**특성**:
- 버전 관리 메커니즘
- 시점별 조회
- 이력 추적

### 마스터-트랜잭션 패턴

```
양식: 제품명 [선택 ▼]
  ↓ "어디서 선택?"
  ↓ "제품 마스터에서"
  ↓
구현: products (마스터)
       ↑ FK
     qc_requests (트랜잭션)
```

**규칙**:
- 선택 가능한 값 = 마스터 엔티티
- 선택하는 문서 = 트랜잭션 엔티티

---

## 4. 시간성 사상

### 생명주기 → 상태 관리

```
양식: 작성중 → 제출됨 → 승인됨 → 완료됨
  ↓
구현: status ENUM('draft', 'submitted', 'approved', 'completed')
     state_changed_at TIMESTAMP
     state_changed_by UUID
```

**필수 속성**:
- 상태 필드
- 상태 변경 시각
- 상태 변경자

### 시점 정보

**기본 시점**:
```
created_at    : 생성 시각
updated_at    : 수정 시각
submitted_at  : 제출 시각 (해당 시)
approved_at   : 승인 시각 (해당 시)
```

**행위자**:
```
created_by    : 생성자
updated_by    : 최종 수정자
```

---

## 5. 무결성 원리

### 완비성 보장

```
양식: 품질검사의뢰서
     제품명 (본질적)
     LOT번호 (본질적)
     특이사항 (부가적)
  ↓
구현: product_id   NOT NULL
     lot_number   NOT NULL
     notes        NULL
```

**규칙**:
- 본질적 요소 = NOT NULL
- 부가적 요소 = NULLABLE
- 설명적 요소 = 주석/문서

### 참조 무결성

| 제약 타입 | 의미 | 사용 시기 |
|-----------|------|-----------|
| CASCADE | 원본 삭제 시 함께 삭제 | 강한 의존 |
| RESTRICT | 관련 문서 있으면 삭제 불가 | 증거 보존 |
| SET NULL | 참조만 해제 | 선택적 관계 |

### 업무 규칙

```
양식 규칙: "검사 수량은 0보다 커야 한다"
  ↓
구현: quantity INTEGER NOT NULL CHECK (quantity > 0)
```

**규칙 위치**:
- 단순 규칙: DB 제약조건
- 복잡 규칙: 애플리케이션 로직
- 도메인 규칙: 도메인 레이어

---

## 6. 사상 프로세스

### 체계적 절차

**1단계: 양식 → 엔티티**
```
품질검사의뢰서 → QCRequest
검사기록지     → QCRecord
제품마스터     → Product
```

**2단계: 필드 → 속성**
```
각 필드 분석:
- 본질적/부가적 분류
- 데이터 타입 결정
- 제약조건 식별
```

**3단계: 관계 식별**
```
[선택] 필드 찾기
  → 마스터 엔티티 식별
  → FK 관계 설정

참조/붙임/스냅샷
  → 적절한 관계 타입 선택
```

**4단계: 생명주기**
```
문서 단계 파악
  → 상태 필드 정의
  → 시점 필드 추가
```

**5단계: 현업 검증**
```
확인 사항:
- 모든 필드 반영?
- 업무 규칙 표현?
- 관계 정확?
```

### 반복적 개선

```
V1: 초기 사상 (기본 구조)
  ↓ 사용 경험
V2: 제약조건 추가
  ↓ 성능 이슈
V3: 정규화/역정규화
  ↓ 업무 변화
V4: 구조 진화
```

---

## 7. 기술 중립성

### 다양한 구현 패러다임

| 패러다임 | 사상 |
|----------|------|
| **관계형 DB** | 양식→테이블, 필드→컬럼, 관계→FK |
| **문서 DB** | 양식→컬렉션, 문서→JSON, 관계→임베디드 |
| **객체지향** | 양식→클래스, 문서→객체, 필드→속성 |
| **그래프 DB** | 양식→노드타입, 문서→노드, 관계→엣지 |

### 불변 원리

```
기술이 바뀌어도:
1. 양식 구조는 보존
2. 관계 의미는 유지
3. 무결성은 보장
4. 생명주기는 추적
```

---

## 8. 실전 예제

### 품질관리 시스템 사상

**양식 도메인**:
```
품질검사의뢰서 --참조--> 제품마스터
검사기록지 --참조--> 품질검사의뢰서
불량기록지 --참조--> 검사기록지
```

**사상 결과**:
```
Product (마스터)
  ├─ id
  ├─ name
  └─ code

QCRequest (트랜잭션)
  ├─ id
  ├─ product_id → Product
  ├─ quantity (CHECK > 0)
  └─ status

QCRecord (트랜잭션)
  ├─ id
  ├─ request_id → QCRequest
  └─ result

DefectRecord (트랜잭션)
  ├─ id
  ├─ record_id → QCRecord
  └─ defect_type
```

**생명주기**:
```
QCRequest: draft → submitted → inspecting → completed
QCRecord: created → inspected → approved
DefectRecord: reported → verified → closed
```

---

## 9. 품질 체크리스트

### 완전성
- [ ] 모든 양식이 엔티티로 사상?
- [ ] 모든 필드가 속성으로 반영?
- [ ] 모든 관계가 명시?
- [ ] 모든 업무 규칙 표현?

### 충실성
- [ ] 양식 구조 보존?
- [ ] 필드 의미 유지?
- [ ] 관계 특성 유지?
- [ ] 생명주기 반영?

### 실용성
- [ ] 현업이 이해 가능?
- [ ] 개발자가 구현 가능?
- [ ] 성능 고려?
- [ ] 유지보수 용이?

---

## 핵심 정리

**사상 원칙**:
1. **구조 보존**: 양식 구조를 있는 그대로
2. **의미 유지**: 필드와 관계의 의미 보존
3. **무결성 보장**: 업무 규칙을 제약으로
4. **검증 가능**: 현업이 확인 가능하게
5. **점진적 개선**: 완벽보다 진화

**핵심 메시지**:
> **"사상은 변환이 아닌 발견이다"**
>
> **"기술은 바뀌어도 원리는 불변이다"**

---

## 더 읽을거리

### 이론적 기반
- [양식 본질론](../03-theory/form-essence-theory.md) - 본질적/부가적 요소
- [문서 관계론](../02-methodology/document-relationships.md) - 참조/붙임/스냅샷
- [양식학 기반](../03-theory/formology-foundations.md) - 8대 핵심 명제

### 실전 적용
- [데이터 모델 도출](../02-methodology/data-modeling.md) - ERD 도출
- [인터페이스 설계](interface-design-theory.md) - UI 사상
- [워크숍 가이드](../04-workshop/facilitation-guide.md) - 실습 방법

---

**개념적 사상**: 양식에서 구현으로의 자연스러운 변환 원리
